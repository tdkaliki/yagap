executor {
    queueSize=500
}
process {
    //cpus   = { check_max( 1    * task.attempt, 'cpus'   ) }
    //memory = { check_max( 100.KB * task.attempt, 'memory' ) }
    //time   = { check_max( 4.h  * task.attempt, 'time'   ) }
    process.executor = 'sge'
    process.clusterOptions = '-pe smp 2 -l h_vmem=1G,h_rt=1:0:0'
    errorStrategy = { task.exitStatus in ((130..145) + 104) ? 'retry' : 'finish' }
    maxRetries    = 1
    maxErrors     = '-1'

    withLabel:portculis {

        cpus   = 5
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:junctools {

        cpus   = 1
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }

    withLabel:hisat2_build {

        cpus   = 1
        
        memory = { 1.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:hisat2_mapping {

        cpus   = 10
        //cpus = { 2 * task.attempt }
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:hisat2 {

        cpus   = 10
        //cpus = { 2 * task.attempt }
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:sam_to_bam {

        cpus   = 1
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:sambamba_sort {

        cpus   = 10
        //cpus = { 2 * task.attempt }
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:samtools_merge {

        cpus   = 20
        //cpus = { 5 * task.attempt }
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:stringtie_hisat {

        cpus   = 10
        //cpus = { 2 * task.attempt }
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:hisat_gtf_list {

        cpus   = 1
        
        memory = { 100.KB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }


    withLabel:minimap2_lr_mapping {

        cpus   = 20
        //cpus = { 5 * task.attempt }
        
        memory = { 10.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:minimap2_lr {

        cpus   = 20
        //cpus = { 5 * task.attempt }
        
        memory = { 10.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:minimap2_cdna_mapping {

        cpus   = 20
        //cpus = { 5 * task.attempt }
        
        memory = { 10.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:minimap2_cdna {

        cpus   = 20
        //cpus = { 5 * task.attempt }
        
        memory = { 10.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:samtools_index {

        cpus   = 10
        //cpus = { 2 * task.attempt }
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:samtools_sort {

        cpus   = 10
        //cpus = { 2 * task.attempt }
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:stringtie_minimap {

        cpus   = 5
        //cpus = { 2 * task.attempt }
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:minimap_gtf_list {

        cpus   = 1
        
        memory = { 100.KB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }

    withLabel:gmap_build {

        cpus   = 1
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:gmap_mapping {

        cpus   = 1
        
        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:gmap_gff_list {

        cpus   = 1
        
        memory = { 100.KB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }

    withLabel:filter_protein {

        cpus   = 1
        
        memory = { 100.KB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 120.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:make_ref_prot_db {

        cpus   = 1
        
        memory = { 4.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:metaeuk_db {

        cpus   = 24
        //cpus = { 8 * task.attempt }

        memory = { 1.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:metaeuk_run {

        cpus   = 24
        //cpus = { 8 * task.attempt }

        memory = { 1.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:filter_metaeuk {

        cpus   = 1

        memory = { 100.KB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:mikado_configure {

        cpus   = 5

        memory = { 2.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:MIKADO_PREPARE {

        cpus   = 5

        memory = { 2.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:diamond {

        cpus   = 18

        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:diamond_db {

        cpus   = 8

        memory = { 2.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:transdecoder {

        cpus   = 4

        memory = { 3.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:MIKADO_SERIALISE {

        cpus   = 10

        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
    withLabel:mikdo_pick {

        cpus   = 10

        memory = { 5.GB * task.attempt }
       
        time = { task.attempt > 1 ? 240.hour : 72.hour }
        maxRetries    = 3
        errorStrategy = 'retry'
    }
}
